<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ashtons Password Vault — NordPass-style (Tailwind)</title>

  <!-- Tailwind Play CDN config + CDN -->
  <script>
    tailwind = {
      config: {
        theme: {
          extend: {
            colors: {
              nordbg: '#1f2326',        // main dark background
              nordpanel: '#2a2f33',     // panels (slightly lighter)
              nordmuted: '#9aa2a6',
              nordaccent: '#dfe6e9',
              nordprimary: '#4f98ff',
              nordglass: 'rgba(255,255,255,0.03)'
            },
            borderRadius: {
              'lg-2': '12px'
            }
          }
        }
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* fine tuning for smooth look */
    .sidebar-scroll {
      scrollbar-width: thin;
    }
    /* subtle item divider line */
    .item-divider { border-top: 1px solid rgba(255,255,255,0.03); }
    /* modal backdrop */
    .modal-backdrop {
      background: linear-gradient(180deg, rgba(8,10,12,0.5), rgba(8,10,12,0.6));
      backdrop-filter: blur(4px);
    }
  </style>
</head>
<body class="min-h-screen antialiased text-nordaccent bg-gradient-to-b from-nordbg/95 to-nordbg">

    <div class="h-screen flex">
        
        <!-- SIDEBAR -->
        <aside class="w-72 bg-nordpanel/95 border-r border-black/20 flex flex-col sidebar-scroll overflow-y-auto p-4">
        <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 bg-gradient-to-br from-nordprimary to-blue-700 rounded-full flex items-center justify-center text-white font-semibold">Ashton</div>
            <div class="flex-1">
            <div class="text-sm font-semibold">Ashton</div>
            <div class="text-xs text-nordmuted">Premium user</div>
            </div>
            <button id="settingsBtn" class="p-2 rounded-full hover:bg-white/3">
            <!-- gear svg -->
            <svg class="w-5 h-5 text-nordmuted" viewBox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" d="M12 15.5a3.5 3.5 0 100-7 3.5 3.5 0 000 7z"/><path stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09c.7 0 1.33-.38 1.51-1a1.65 1.65 0 00-.33-1.82L3.3 4.7A2 2 0 016.13 1.87l.06.06c.45.45 1.05.69 1.69.69.3 0 .6-.04.88-.12A1.65 1.65 0 0110 1h4c.4 0 .77.12 1.09.32.28.08.58.12.88.12.64 0 1.24-.24 1.69-.69l.06-.06A2 2 0 0120.7 3.3l-.06.06a1.65 1.65 0 00-.33 1.82c.16.6.8 1 1.51 1H21a2 2 0 010 4h-.09c-.7 0-1.33.38-1.51 1z"/></svg>
            </button>
        </div>

        <div class="relative mb-4">
            <input id="sidebarSearch" type="search" placeholder="Search (⌘/Ctrl+F)" class="w-full bg-black/10 placeholder-nordmuted text-sm rounded-lg py-2 px-3 focus:outline-none focus:ring-1 focus:ring-nordprimary"/>
        </div>

        <nav class="mb-4">
            <div class="text-xs uppercase text-nordmuted font-semibold mb-2 px-2">Categories</div>
            <ul class="space-y-1">
            <li class="px-2">
                <button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg bg-white/2">
                <svg class="w-5 h-5 text-nordmuted" viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="18" height="18" rx="4" stroke="currentColor" stroke-width="1.2"/></svg>
                <span class="flex-1">All Items</span>
                <span class="text-xs text-nordmuted">38</span>
                </button>
            </li>
            <li class="px-2"><button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/2"><svg class="w-5 h-5 text-nordmuted" viewBox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-width="1.2" d="M3 12h18"/></svg> Passkeys</button></li>
            <li class="px-2"><button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/2"><svg class="w-5 h-5 text-nordmuted" viewBox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-width="1.2" d="M12 5v14M5 12h14"/></svg>Logins</button></li>
            <li class="px-2"><button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/2"><svg class="w-5 h-5 text-nordmuted" viewBox="0 0 24 24" fill="none"><rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="1.2"/></svg> Wifi</button></li>
            <li class="px-2"><button class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/2"><svg class="w-5 h-5 text-nordmuted" viewBox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-width="1.2" d="M12 3v18M3 12h18"/></svg> Personal Info</button></li>
            </ul>
        </nav>

        <div class="mt-auto text-xs text-nordmuted px-2">
            <div class="mb-3">Tools</div>
            <ul class="space-y-2">
            <li class="flex items-center justify-between"><span>Password Generator</span><button id="sidebarGen" class="px-2 py-1 text-xs rounded bg-white/3">Open</button></li>
            </ul>
        </div>
        </aside>

        <!-- MAIN -->
        <main class="flex-1 flex flex-col">
        
            <!-- TOP BAR -->
        <header class="flex items-center justify-between px-8 py-6 border-b border-black/20">
            <div class="flex items-center gap-6">
                <h1 class="text-2xl font-semibold tracking-tight">All Items</h1>
                <div class="text-sm text-nordmuted">Title</div>
                <div class="ml-4 text-sm text-nordmuted">Last Used ▾</div>
            </div>

            <div class="flex items-center gap-3">
                <input id="search" type="search" placeholder="Search site/email/note" class="hidden md:inline-block w-72 bg-black/10 placeholder-nordmuted text-sm rounded-lg py-2 px-3 focus:outline-none focus:ring-1 focus:ring-nordprimary"/>
                <button id="exportBtn" class="px-4 py-2 rounded-full border border-white/6 text-sm hover:bg-white/3">Export</button>
                <button id="importBtn" class="px-4 py-2 rounded-full border border-white/6 text-sm hover:bg-white/3">Import</button>
                <button id="addItemBtn" class="px-4 py-2 rounded-full bg-nordglass border border-white/6 text-sm hover:bg-white/5">Add Item</button>
            </div>
        </header>

        <!-- LIST -->
        <section id="listWrap" class="flex-1 overflow-auto p-8">
            <div id="list" class="space-y-0 rounded-lg shadow-sm">
            <!-- items inserted here by JS -->
            </div>
        </section>
        </main>
    </div>

    <!-- Floating Add / Modal form -->
    <div id="modal" class="fixed inset-0 hidden items-center justify-center z-50">
        <div class="absolute inset-0 modal-backdrop"></div>
        <div class="relative w-full max-w-2xl mx-4 bg-nordpanel rounded-2xl p-6 z-10">
        <div class="flex items-start justify-between gap-4">
            <div>
            <h2 class="text-lg font-semibold">Add / Edit Password</h2>
            <p class="text-sm text-nordmuted">Encrypted in Github.</p>
            </div>
            <div class="flex items-center gap-2">
            <button id="exportBtnTop" class="px-3 py-1 rounded bg-white/3 hidden">Export</button>
            <button id="closeModal" class="p-2 rounded hover:bg-white/4" title="Close">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M18 6L6 18M6 6l12 12"/></svg>
            </button>
            </div>
        </div>

        <form id="entryForm" class="mt-4 grid grid-cols-2 gap-4">
            <div>
            <label class="text-xs text-nordmuted">Name / Site</label>
            <input id="title" required placeholder="e.g. Gmail, Work login" class="mt-1 w-full bg-black/10 rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-nordprimary"/>
            </div>
            <div>
            <label class="text-xs text-nordmuted">URL</label>
            <input id="url" placeholder="https://" class="mt-1 w-full bg-black/10 rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-nordprimary"/>
            </div>
            <div>
            <label class="text-xs text-nordmuted">Email / Username</label>
            <input id="email" placeholder="you@example.com" class="mt-1 w-full bg-black/10 rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-nordprimary"/>
            </div>
            <div>
            <label class="text-xs text-nordmuted">Password</label>
            <div class="mt-1 flex gap-2">
                <input id="password" placeholder="password" class="flex-1 bg-black/10 rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-nordprimary"/>
                <button type="button" id="gen" class="px-3 py-2 rounded-lg bg-white/3">Gen</button>
            </div>
            </div>

            <div class="col-span-2">
            <label class="text-xs text-nordmuted">Note (optional)</label>
            <textarea id="note" rows="3" placeholder="anything you want to remember" class="mt-1 w-full bg-black/10 rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-nordprimary"></textarea>
            </div>

            <div class="col-span-1">
            <div class="mt-2 flex items-center gap-2">
                <button id="save" class="px-4 py-2 rounded-lg bg-nordprimary text-white">Add</button>
                <button id="clear" type="button" class="px-4 py-2 rounded-lg bg-white/5">Clear</button>
            </div>
            </div>
            <div class="col-span-1 flex items-center justify-end">
            <div class="text-sm text-nordmuted">Stored: <span id="count">0</span></div>
            </div>
        </form>
        </div>
    </div>

    <!-- hidden file input -->
    <input id="fileInput" type="file" accept="application/json" style="display:none" />

    <script>
    // --- CONFIG (keep same logic) ---
    const GITHUB_USER = 'ab23223';
    const GITHUB_REPO = 'passwordvault';
    const GITHUB_BRANCH = 'main';
    const VAULT_FILE_PATH = 'vault-data.json';

    let GITHUB_TOKEN = null;
    let GITHUB_SHA = null;

    // elements (modal form inputs are same IDs as before)
    const form = document.getElementById('entryForm');
    const titleEl = document.getElementById('title');
    const urlEl = document.getElementById('url');
    const emailEl = document.getElementById('email');
    const passwordEl = document.getElementById('password');
    const noteEl = document.getElementById('note');
    const listEl = document.getElementById('list');
    const countEl = document.getElementById('count');
    const searchEl = document.getElementById('search');
    const genBtn = document.getElementById('gen');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const fileInput = document.getElementById('fileInput');
    const clearBtn = document.getElementById('clear');
    const addItemBtn = document.getElementById('addItemBtn');

    const sidebarSearch = document.getElementById('sidebarSearch');
    const sidebarGen = document.getElementById('sidebarGen');

    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    // also keep top export if needed
    const exportBtnTop = document.getElementById('exportBtnTop');

    let entries = [];
    let editId = null;

    init();

    // ---------------- INIT ----------------
    async function init(){
        // save token in localStorage (same as before)
        GITHUB_TOKEN = localStorage.getItem('vaultGitHubToken');
        if(!GITHUB_TOKEN){
        GITHUB_TOKEN = prompt('Enter your GitHub Personal Access Token (repo scope)');
        if(!GITHUB_TOKEN){ alert('Vault cannot load without token'); return; }
        localStorage.setItem('vaultGitHubToken', GITHUB_TOKEN);
        }
        try {
        await loadVault();
        } catch(err) {
        alert('Failed to load vault. Please re-enter your GitHub token.');
        localStorage.removeItem('vaultGitHubToken');
        location.reload();
        }
        render();
    }

    // ---------------- EVENT BINDINGS ----------------
    // modal open/close
    addItemBtn.addEventListener('click', ()=>{ openModal(); });
    closeModal.addEventListener('click', ()=>{ closeModalFn(); });

    // form submit
    form.addEventListener('submit', e => { e.preventDefault(); saveEntry(); });

    genBtn.addEventListener('click', ()=>{ passwordEl.value = generatePassword(14); passwordEl.focus(); });
    sidebarGen.addEventListener('click', ()=>{ openModal(); passwordEl.value = generatePassword(14); });

    clearBtn.addEventListener('click', ()=>{ form.reset(); editId=null; document.getElementById('save').textContent='Add'; });

    // search inputs: main and sidebar both control rendering
    [searchEl, sidebarSearch].forEach(inp=>{
        if(inp) inp.addEventListener('input', render);
    });

    exportBtn.addEventListener('click', () => {
        const blob = new Blob([JSON.stringify(entries,null,2)],{type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download='vault-backup.json'; a.click();
        URL.revokeObjectURL(url);
    });
    // also wire top export if present
    if(exportBtnTop) exportBtnTop.addEventListener('click', ()=>exportBtn.click());

    importBtn.addEventListener('click', ()=>fileInput.click());
    fileInput.addEventListener('change',(e)=>{
        const file=e.target.files[0]; if(!file) return;
        const reader=new FileReader();
        reader.onload=()=>{
        try{ const data=JSON.parse(reader.result); if(!Array.isArray(data)) throw 0; entries=data; saveVault(); render(); alert('Imported '+data.length+' entries.'); }
        catch{ alert('Invalid file'); }
        };
        reader.readAsText(file); fileInput.value='';
    });

    // Ctrl+F shortcut for search / focus
    window.addEventListener('keydown',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='f'){ e.preventDefault(); if(searchEl){ searchEl.focus(); searchEl.select(); } else if(sidebarSearch){ sidebarSearch.focus(); sidebarSearch.select(); } } });

    // auto reload vault every 30s
    setInterval(loadVault, 30000);

    // ---------------- GITHUB LOAD / SAVE (unchanged) ----------------
    async function loadVault(){
        try{
        const resp = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${VAULT_FILE_PATH}?ref=${GITHUB_BRANCH}`,{
            headers:{Authorization:'token '+GITHUB_TOKEN}
        });
        if(!resp.ok) throw new Error('Failed to fetch vault');
        const data = await resp.json();
        GITHUB_SHA = data.sha;
        const content = atob(data.content.replace(/\n/g,''));
        entries = JSON.parse(content);
        }catch(err){
        entries = [];
        console.warn('Could not load vault',err);
        }
    }

    async function saveVault(){
        try{
        const content = btoa(JSON.stringify(entries,null,2));
        const body = {
            message: 'Update vault',
            content,
            sha: GITHUB_SHA,
            committer: { name: 'Vault Bot', email: 'bot@example.com' },
            author: { name: 'Vault Bot', email: 'bot@example.com' }
        };
        if(GITHUB_SHA) body.sha = GITHUB_SHA;

        const resp = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${VAULT_FILE_PATH}`,{
            method:'PUT',
            headers:{Authorization:'token '+GITHUB_TOKEN,'Content-Type':'application/json'},
            body:JSON.stringify(body)
        });
        if(!resp.ok){
            const text = await resp.text();
            throw new Error(text || 'Failed to save vault');
        }
        const data = await resp.json();
        GITHUB_SHA = data.content.sha;
        console.log('Vault saved successfully ✅');
        }catch(err){
        alert('Error saving vault: '+(err.message || err));
        console.error(err);
        }
    }

    // ---------------- CRUD ----------------
    async function saveEntry(){
        const title = titleEl.value.trim(); if(!title){ alert('Please add a name/site'); return; }
        const item = { id: editId||cryptoRandomId(), title, url:urlEl.value.trim(), email:emailEl.value.trim(), password:passwordEl.value, note:noteEl.value.trim(), updated:Date.now() };
        if(editId){ const i = entries.findIndex(x=>x.id===editId); if(i>=0) entries[i]=item; editId=null; document.getElementById('save').textContent='Add'; }
        else entries.unshift(item);
        sortEntries();
        form.reset();
        await saveVault();
        render();
        closeModalFn();
    }

    async function deleteEntry(id){
        entries = entries.filter(x=>x.id!==id);
        await saveVault();
        render();
    }

    function sortEntries() {
        entries.sort((a, b) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));
    }

    function populateFormForEdit(e){
        openModal();
        titleEl.value=e.title||'';
        urlEl.value=e.url||'';
        emailEl.value=e.email||'';
        passwordEl.value=e.password||'';
        noteEl.value=e.note||'';
        editId=e.id;
        document.getElementById('save').textContent='Save';
        // scroll modal to top if needed
    }

    // ---------------- RENDER ----------------
    function render(){
        const q = (searchEl && searchEl.value || sidebarSearch && sidebarSearch.value || '').trim().toLowerCase();
        listEl.innerHTML='';
        const filtered = entries
        .filter(e => !q || (e.title + e.email + e.note + e.url).toLowerCase().includes(q))
        .sort((a, b) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));
        countEl.textContent = entries.length;

        if(filtered.length===0){
        listEl.innerHTML = '<div class="text-nordmuted p-4 rounded-lg">No entries yet.</div>';
        return;
        }

        filtered.forEach(e=>{
        const row = document.createElement('div');
        row.className = 'flex items-center justify-between gap-4 p-4 rounded-lg bg-black/5 item-divider';

        // left: site + meta
        const left = document.createElement('div');
        left.className = 'flex items-center gap-4 min-w-0';

        const logo = document.createElement('div');
        logo.className = 'w-12 h-12 rounded-lg bg-white/5 flex items-center justify-center flex-shrink-0';
        // simple letter or favicon placeholder
        const logoText = document.createElement('div');
        logoText.className = 'text-white font-semibold';
        logoText.textContent = e.title ? e.title.charAt(0).toUpperCase() : '?';
        logo.appendChild(logoText);

        const site = document.createElement('div');
        site.className = 'min-w-0';

        const h = document.createElement('div');
        h.className = 'text-sm font-semibold truncate';
        h.textContent = e.title;
        const p = document.createElement('div');
        p.className = 'text-xs text-nordmuted truncate mt-0.5';
        // show email • shortUrl
        const parts = [];
        if(e.email) parts.push(escapeHtml(e.email));
        if(e.url) parts.push(shortUrl(e.url));
        if(e.note) parts.push('Note');
        p.innerHTML = parts.join(' • ');

        site.appendChild(h);
        site.appendChild(p);
        left.appendChild(logo);
        left.appendChild(site);

        // right: last used + actions
        const right = document.createElement('div');
        right.className = 'flex items-center gap-3';

        const last = document.createElement('div');
        last.className = 'text-xs text-nordmuted text-right w-28';
        last.textContent = timeAgo(e.updated);

        const actions = document.createElement('div');
        actions.className = 'flex gap-2 items-center';

        const pwSpan = document.createElement('span');
        pwSpan.className = 'text-xs text-nordmuted monospace';
        pwSpan.textContent = '••••••';

        let showing = false;
        const pwBtn = document.createElement('button');
        pwBtn.className = 'px-3 py-1 text-xs rounded bg-white/3 hover:bg-white/4';
        pwBtn.textContent = 'Show';
        pwBtn.addEventListener('click', ()=>{
            showing = !showing;
            pwSpan.textContent = showing ? e.password : '••••••';
            pwBtn.textContent = showing ? 'Hide' : 'Show';
        });

        const copyBtn = document.createElement('button');
        copyBtn.className = 'px-3 py-1 text-xs rounded bg-white/3 hover:bg-white/4';
        copyBtn.textContent = 'Copy';
        copyBtn.addEventListener('click', async ()=>{
            try{ await navigator.clipboard.writeText(e.password||''); showToast('Copied'); }catch{ prompt('Copy manually', e.password||''); }
        });

        const editBtn = document.createElement('button');
        editBtn.className = 'px-3 py-1 text-xs rounded bg-nordprimary text-white';
        editBtn.textContent = 'Edit';
        editBtn.addEventListener('click', ()=> populateFormForEdit(e));

        const delBtn = document.createElement('button');
        delBtn.className = 'px-3 py-1 text-xs rounded bg-white/5 hover:bg-white/6';
        delBtn.textContent = 'Delete';
        delBtn.addEventListener('click', ()=>{ if(confirm('Delete "'+e.title+'"?')) deleteEntry(e.id); });

        actions.appendChild(pwSpan);
        actions.appendChild(pwBtn);
        actions.appendChild(copyBtn);
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        right.appendChild(last);
        right.appendChild(actions);

        row.appendChild(left);
        row.appendChild(right);

        listEl.appendChild(row);
        });
    }

    // ---------------- HELPERS ----------------
    function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>\"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function shortUrl(u){ try{ return new URL(u).hostname; }catch{return u.length>30?u.slice(0,27)+'...':u; } }
    function cryptoRandomId(){ return 'id-'+Math.random().toString(36).slice(2,10)+Date.now().toString(36).slice(-4); }
    function generatePassword(len){ const sets='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?'; let out=''; const rng=crypto.getRandomValues?crypto.getRandomValues(new Uint32Array(len)):null; for(let i=0;i<len;i++){ const idx=rng?rng[i]%sets.length:Math.floor(Math.random()*sets.length); out+=sets.charAt(idx); } return out; }

    function timeAgo(ts){
        if(!ts) return '-';
        const s = Math.floor((Date.now()-ts)/1000);
        if(s < 60) return s + 's ago';
        const m = Math.floor(s/60);
        if(m < 60) return m + 'm ago';
        const h = Math.floor(m/60);
        if(h < 24) return h + 'h ago';
        const d = Math.floor(h/24);
        return d + 'd ago';
    }

    // simple toast
    function showToast(msg){
        const t = document.createElement('div');
        t.className = 'fixed bottom-8 right-8 bg-black/70 text-white px-4 py-2 rounded-md z-60';
        t.textContent = msg;
        document.body.appendChild(t);
        setTimeout(()=>{ t.remove(); }, 1500);
    }

    // modal open/close
    function openModal(){ modal.classList.remove('hidden'); modal.classList.add('flex'); setTimeout(()=> titleEl.focus(),80); }
    function closeModalFn(){ modal.classList.add('hidden'); modal.classList.remove('flex'); form.reset(); editId=null; document.getElementById('save').textContent='Add'; }

    let sortMode = 'name';
        sortBtn.addEventListener('click', () => {
        sortMode = sortMode === 'name' ? 'date' : 'name';
        if (sortMode === 'name')
            entries.sort((a, b) => a.title.localeCompare(b.title));
        else
            entries.sort((a, b) => b.updated - a.updated);
        render();
    });

    </script>

</body>
</html>